<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¦»æ‚¦è®ºå› Â· çŠ¶æ€</title>
    <link rel="preconnect" href="https://fontsapi.zeoseven.com" crossorigin />
    <link
      href="https://fontsapi.zeoseven.com/292/main/result.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --dark-red: #c92a2a;
        --blood-red: #e03131;
        --light-red: #ff6b6b;
        --dark-gray: #1a1a1a;
        --gray: #2a2a2a;
        --light-gray: #3a3a3a;
        --text-main: #e0e0e0;
        --text-dim: #999;
        --gold: #ffd700;
        --border: rgba(220, 20, 60, 0.2);
        --pink: #ff69b4;
        --teal: #20c997;
      }
      [data-theme="light"] {
        --dark-red: #c92a2a;
        --blood-red: #e03131;
        --light-red: #ff6b6b;
        --dark-gray: #f5f5f5;
        --gray: #ececec;
        --light-gray: #e0e0e0;
        --text-main: #2a2a2a;
        --text-dim: #666;
        --gold: #d97706;
        --border: rgba(220, 20, 60, 0.15);
        --pink: #e91e8c;
        --teal: #0ca678;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Noto Sans SC", -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        background: transparent;
        color: var(--text-main);
        padding: 12px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .status-container {
        max-width: 520px;
        margin: 0 auto;
      }
      .status-card {
        background: var(--dark-gray);
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        contain: content;
      }
      .status-header {
        background: linear-gradient(
          135deg,
          var(--dark-red) 0%,
          var(--blood-red) 100%
        );
        padding: 14px 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        user-select: none;
      }
      .header-left {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .status-icon {
        font-size: 20px;
      }
      .status-title {
        font-size: 16px;
        font-weight: 600;
        color: #fff;
      }
      .header-right {
        display: flex;
        gap: 10px;
      }
      .theme-toggle,
      .collapse-toggle {
        width: 28px;
        height: 28px;
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        color: #fff;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 14px;
      }
      .info-button {
        height: 28px;
        padding: 0 10px;
        border-radius: 6px;
        background: rgba(0, 0, 0, 0.22);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: #fff;
        font-size: 12px;
        font-weight: 600;
        letter-spacing: 0.3px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .info-button:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-1px);
      }
      .theme-toggle:hover,
      .collapse-toggle:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: scale(1.05);
      }
      .status-body {
        padding: 0;
        max-height: 800px;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
          opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 1;
      }
      .status-body.collapsed {
        max-height: 0;
        opacity: 0;
      }
      .info-modal {
        position: fixed;
        inset: 0;
        z-index: 1200;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.25s ease;
      }
      .info-modal.is-open {
        opacity: 1;
        pointer-events: auto;
      }
      .info-modal-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
      }
      .info-modal-panel {
        position: relative;
        width: calc(100% - 32px);
        max-width: 360px;
        background: var(--gray);
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
        padding: 16px 18px 18px;
        z-index: 1;
        transform: translateY(8px);
        transition: transform 0.25s ease;
      }
      .info-modal.is-open .info-modal-panel {
        transform: translateY(0);
      }
      .info-modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 8px;
      }
      .info-modal-title {
        font-size: 14px;
        font-weight: 700;
        color: var(--text-main);
      }
      .info-modal-close {
        width: 26px;
        height: 26px;
        border-radius: 6px;
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-main);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }
      .info-modal-close:hover {
        background: rgba(255, 255, 255, 0.12);
      }
      .info-modal-body {
        font-size: 13px;
        line-height: 1.6;
        color: var(--text-main);
      }
      .status-section {
        border-bottom: 1px solid var(--border);
      }
      .status-section:last-child {
        border-bottom: none;
      }
      .section-header {
        padding: 12px 18px;
        background: var(--gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        user-select: none;
        transition: background 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .section-header:hover {
        background: var(--light-gray);
      }
      .section-title {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-main);
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .section-icon {
        font-size: 16px;
      }
      .section-toggle {
        font-size: 12px;
        color: var(--text-dim);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .section-toggle.collapsed {
        transform: rotate(-90deg);
      }
      .section-content {
        padding: 16px 18px;
        max-height: 600px;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
          opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
          padding 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 1;
      }
      .section-content.collapsed {
        max-height: 0;
        padding: 0 18px;
        opacity: 0;
      }
      #event-section .section-content {
        display: block !important;
        max-height: none !important;
        padding: 16px 18px !important;
        padding-top: 18px !important;
        opacity: 1 !important;
      }
      .section-content::-webkit-scrollbar {
        width: 6px;
      }
      .section-content::-webkit-scrollbar-track {
        background: var(--dark-gray);
      }
      .section-content::-webkit-scrollbar-thumb {
        background: var(--dark-red);
        border-radius: 3px;
      }
      .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
      }
      .status-item {
        background: var(--gray);
        border: 1px solid var(--light-gray);
        border-radius: 8px;
        padding: 12px 14px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .status-item:hover {
        background: var(--light-gray);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      .item-label {
        font-size: 12px;
        color: var(--text-dim);
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .item-emoji {
        font-size: 14px;
      }
      .item-value {
        font-size: 15px;
        font-weight: 600;
        color: var(--text-main);
        display: flex;
        align-items: center;
      }
      .item-value.highlight {
        color: var(--gold);
      }
      .progress-container {
        margin-top: 6px;
      }
      .progress-bar {
        height: 6px;
        background: var(--dark-gray);
        border-radius: 3px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--blood-red), var(--light-red));
        border-radius: 3px;
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .exp-progress-fill {
        background: linear-gradient(90deg, #4ecdc4, #44a8a0);
      }
      .subscribe-progress-fill {
        background: linear-gradient(90deg, #ff69b4, #ff1493);
      }
      .quota-progress-fill {
        background: linear-gradient(90deg, #ffd700, #ffaa00);
      }
      .event-panel {
        background: var(--gray);
        border: 1px solid var(--light-gray);
        border-radius: 8px;
        padding: 16px;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .event-panel:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      .event-status {
        display: inline-block;
        background: var(--dark-red);
        color: #fff;
        padding: 3px 10px;
        border-radius: 4px;
        font-size: 11px;
        margin-bottom: 10px;
        font-weight: 600;
      }
      .event-name {
        font-size: 15px;
        margin-bottom: 10px;
        color: var(--light-red);
        font-weight: 600;
      }
      .event-details {
        display: flex;
        flex-direction: column;
        gap: 8px;
        font-size: 13px;
        color: var(--text-dim);
      }
      .event-detail-item {
        display: flex;
        justify-content: space-between;
        padding: 6px 0;
        border-bottom: 1px solid var(--border);
        gap: 12px;
        align-items: flex-start;
      }
      .event-detail-item:last-child {
        border-bottom: none;
      }
      .event-detail-item span:first-child {
        color: var(--text-dim);
        flex-shrink: 0;
        white-space: nowrap;
      }
      .event-detail-item span:last-child {
        color: var(--text-main);
        font-weight: 500;
        text-align: right;
        word-wrap: break-word;
        word-break: break-word;
        line-height: 1.5;
        flex: 1;
        max-width: 70%;
      }
      .event-detail-item span:last-child::-webkit-scrollbar {
        width: 4px;
      }
      .event-detail-item span:last-child::-webkit-scrollbar-track {
        background: var(--dark-gray);
        border-radius: 2px;
      }
      .event-detail-item span:last-child::-webkit-scrollbar-thumb {
        background: var(--dark-red);
        border-radius: 2px;
      }
      .event-detail-item.special-requirements {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .requirements-list {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 6px;
        padding-left: 0;
        max-height: 134px;
        overflow-y: auto;
        padding-right: 4px;
      }
      .requirements-list::-webkit-scrollbar {
        width: 4px;
      }
      .requirements-list::-webkit-scrollbar-track {
        background: var(--dark-gray);
        border-radius: 2px;
      }
      .requirements-list::-webkit-scrollbar-thumb {
        background: var(--dark-red);
        border-radius: 2px;
      }
      .requirement-item {
        color: var(--text-main);
        font-weight: 500;
        line-height: 1.6;
        padding-left: 4px;
      }
      .payment-status-indicator {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-top: 4px;
      }
      .status-light {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        box-shadow: 0 0 4px currentColor;
        animation: pulse 2s ease-in-out infinite;
      }
      .status-light.red {
        background-color: #ff4444;
        color: #ff4444;
      }
      .status-light.green {
        background-color: #44ff44;
        color: #44ff44;
      }
      .status-light.yellow {
        background-color: #ffdd44;
        color: #ffdd44;
      }
      .event-type-tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        color: #fff;
      }
      .event-type-tag.couple {
        background: linear-gradient(135deg, var(--dark-red), var(--blood-red));
      }
      .event-type-tag.solo-cheat {
        background: linear-gradient(135deg, #e91e63, #ff69b4);
      }
      .event-type-tag.solo-seek {
        background: linear-gradient(135deg, #00bcd4, #4dd0e1);
      }
      .event-type-tag.other {
        background: linear-gradient(135deg, #607d8b, #90a4ae);
      }
      .participant-section {
        background: var(--dark-gray);
        border-radius: 6px;
        padding: 10px 12px;
        margin-top: 4px;
      }
      .participant-title {
        font-size: 11px;
        color: var(--text-dim);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .participant-title .icon {
        font-size: 12px;
      }
      .participant-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }
      .participant-item {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .participant-label {
        font-size: 10px;
        color: var(--text-dim);
      }
      .participant-value {
        font-size: 13px;
        font-weight: 500;
        color: var(--text-main);
      }
      .participant-value.female {
        color: var(--pink);
      }
      .participant-value.male {
        color: #64b5f6;
      }
      .participant-value.unknown {
        color: var(--text-dim);
        font-style: italic;
      }
      .solo-indicator {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 6px;
        background: rgba(233, 30, 99, 0.15);
        border-radius: 4px;
        font-size: 10px;
        color: var(--pink);
        margin-left: 6px;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
      }
      @media (max-width: 640px) {
        body {
          padding-bottom: max(24px, env(safe-area-inset-bottom, 24px));
        }
        .status-card {
          margin-bottom: 16px;
        }
        .status-container {
          max-width: 100%;
        }
        .status-grid {
          grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
          gap: 8px;
        }
        .status-item {
          padding: 10px 10px;
        }
        #subscribe-section .status-grid {
          grid-template-columns: repeat(3, 1fr);
        }
        .section-content {
          padding: 14px 16px;
        }
        .event-panel {
          padding: 14px;
        }
        .participant-grid {
          grid-template-columns: 1fr;
        }
      }
      @media (min-width: 641px) {
        .status-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="status-container">
      <div class="status-card">
        <div class="status-header" onclick="toggleMainCollapse()">
          <div class="header-left">
            <div class="status-icon">ğŸ”</div>
            <div class="status-title">å¦»æ‚¦è®ºå›</div>
          </div>
          <div class="header-right">
            <button class="info-button" onclick="openInfoModal(event)">
              å¿…çœ‹è¯´æ˜
            </button>
            <button class="theme-toggle" onclick="toggleTheme(event)">
              ğŸŒ“
            </button>
            <button class="collapse-toggle" onclick="toggleMainCollapse(event)">
              <span id="main-collapse-icon">â–¼</span>
            </button>
          </div>
        </div>
        <div class="status-body" id="status-body">
          <div class="status-section">
            <div class="section-header" onclick="toggleSection('time-section')">
              <div class="section-title">
                <span class="section-icon">â°</span>
                <span>æ—¶é—´ä¿¡æ¯</span>
              </div>
              <span class="section-toggle" id="time-toggle">â–¼</span>
            </div>
            <div class="section-content" id="time-section">
              <div class="status-grid">
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">ğŸ“…</span>æ—¥æœŸ
                  </span>
                  <span class="item-value" id="current-date">2024-01-15</span>
                </div>
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">ğŸ•</span>æ—¶åˆ»
                  </span>
                  <span class="item-value" id="current-time">14:30</span>
                </div>
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">ğŸ“†</span>æ˜ŸæœŸ
                  </span>
                  <span class="item-value" id="current-weekday">ä¸€</span>
                </div>
              </div>
            </div>
          </div>
          <div class="status-section">
            <div
              class="section-header"
              onclick="toggleSection('account-section')"
            >
              <div class="section-title">
                <span class="section-icon">ğŸ’³</span>
                <span>è´¦æˆ·çŠ¶æ€</span>
              </div>
              <span class="section-toggle" id="account-toggle">â–¼</span>
            </div>
            <div class="section-content" id="account-section">
              <div class="status-grid">
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">ğŸ’</span>ç§¯åˆ†
                  </span>
                  <span class="item-value highlight" id="account-points"
                    >5000</span
                  >
                </div>
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">â­</span>ç­‰çº§
                  </span>
                  <span class="item-value" id="account-level">20</span>
                  <div class="progress-container">
                    <div class="progress-bar">
                      <div class="progress-fill" id="level-progress"></div>
                    </div>
                  </div>
                </div>
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">âœ¨</span>ç»éªŒå€¼
                  </span>
                  <span class="item-value" id="account-exp">45</span>
                  <div class="progress-container">
                    <div class="progress-bar">
                      <div
                        class="progress-fill exp-progress-fill"
                        id="exp-progress"
                      ></div>
                    </div>
                  </div>
                </div>
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">ğŸ’°</span>ç°é‡‘ä½™é¢
                  </span>
                  <span class="item-value highlight" id="account-cash">Â¥0</span>
                </div>
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">ğŸ“Š</span>ç´¯è®¡æœåŠ¡
                  </span>
                  <span class="item-value" id="account-services">8æ¬¡</span>
                </div>
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">ğŸ‘</span>å¥½è¯„ç‡
                  </span>
                  <span class="item-value" id="account-rating">92.5%</span>
                </div>
              </div>
            </div>
          </div>
          <div class="status-section">
            <div
              class="section-header"
              onclick="toggleSection('subscribe-section')"
            >
              <div class="section-title">
                <span class="section-icon">ğŸ“º</span>
                <span>ç›´æ’­è®¢é˜…</span>
              </div>
              <span class="section-toggle" id="subscribe-toggle">â–¼</span>
            </div>
            <div class="section-content" id="subscribe-section">
              <div class="status-grid">
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">ğŸ«</span>åŒ…æœˆè®¢é˜…
                  </span>
                  <span class="item-value" id="subscribe-type">æ— è®¢é˜…</span>
                </div>
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">â³</span>å‰©ä½™æ—¶é—´
                  </span>
                  <span class="item-value" id="subscribe-days">0å¤©</span>
                  <div class="progress-container">
                    <div class="progress-bar">
                      <div
                        class="progress-fill subscribe-progress-fill"
                        id="subscribe-progress"
                      ></div>
                    </div>
                  </div>
                </div>
                <div class="status-item">
                  <span class="item-label">
                    <span class="item-emoji">ğŸ</span>å…è´¹é¢åº¦
                  </span>
                  <span class="item-value" id="subscribe-quota">0æ¬¡</span>
                  <div class="progress-container">
                    <div class="progress-bar">
                      <div
                        class="progress-fill quota-progress-fill"
                        id="quota-progress"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="status-section" id="event-section">
          <div class="section-content" style="padding-top: 18px">
            <div
              style="
                font-size: 13px;
                font-weight: 600;
                color: var(--text-main);
                margin-bottom: 12px;
                display: flex;
                align-items: center;
                gap: 8px;
              "
            >
              <span style="font-size: 16px">ğŸ¯</span>
              <span>å½“å‰äº‹ä»¶</span>
            </div>
            <div class="event-panel">
              <span class="event-status" id="event-status">æœªå¼€å§‹</span>
              <div class="event-name" id="event-name">æ— äº‹ä»¶</div>
              <div class="event-details" id="event-details"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="info-modal" id="info-modal" aria-hidden="true">
      <div class="info-modal-backdrop" onclick="closeInfoModal(event)"></div>
      <div
        class="info-modal-panel"
        role="dialog"
        aria-modal="true"
        aria-labelledby="info-modal-title"
      >
        <div class="info-modal-header">
          <div class="info-modal-title" id="info-modal-title">å¿…çœ‹è¯´æ˜</div>
          <button class="info-modal-close" onclick="closeInfoModal(event)">
            âœ•
          </button>
        </div>
        <div class="info-modal-body">
          å›¾ç‰‡åªä¼šåœ¨è®ºå›å‰ç«¯ç»“æ„ä¸­å‡ºç°ï¼Œæ­£æ–‡æ²¡æœ‰å›¾ç‰‡ã€‚
        </div>
      </div>
    </div>
    <script>
      function openInfoModal(event) {
        if (event) event.stopPropagation();
        const modal = document.getElementById("info-modal");
        if (!modal) return;
        modal.classList.add("is-open");
        modal.setAttribute("aria-hidden", "false");
      }

      function closeInfoModal(event) {
        if (event) event.stopPropagation();
        const modal = document.getElementById("info-modal");
        if (!modal) return;
        modal.classList.remove("is-open");
        modal.setAttribute("aria-hidden", "true");
      }

      document.addEventListener("keydown", (event) => {
        if (event.key !== "Escape") return;
        const modal = document.getElementById("info-modal");
        if (modal && modal.classList.contains("is-open")) {
          closeInfoModal();
        }
      });

      function SafeGetValue(obj, path, defaultValue = "N/A") {
        let keys = Array.isArray(path) ? path : path.split(".");
        let current = obj;
        for (let i = 0; i < keys.length; i++) {
          if (
            current === undefined ||
            current === null ||
            typeof current !== "object" ||
            !current.hasOwnProperty(keys[i])
          ) {
            return defaultValue;
          }
          current = current[keys[i]];
        }
        if (current === undefined || current === null) {
          return defaultValue;
        }
        if (Array.isArray(current)) {
          if (current.length > 0) {
            const actualValue = current[0];
            if (typeof actualValue === "boolean") {
              return actualValue;
            }
            return String(actualValue);
          } else {
            return defaultValue;
          }
        }
        if (typeof current === "boolean") {
          return current;
        }
        if (typeof current === "number") {
          return current;
        }
        if (typeof current === "string") {
          return current;
        }
        return JSON.stringify(current);
      }

      function updateProgressBar(
        barId,
        valueMainId,
        valueDescId,
        rawValue,
        min = 0,
        max = 100,
        color
      ) {
        const progressBar = document.getElementById(barId);
        const valueMainDisplay = document.getElementById(valueMainId);
        const valueDescDisplay = document.getElementById(valueDescId);
        if (!progressBar || !valueMainDisplay) {
          return;
        }
        let numericValue = parseFloat(rawValue);
        if (isNaN(numericValue)) {
          numericValue = parseFloat(String(rawValue).replace(/[^0-9.-]/g, ""));
        }
        if (!isNaN(numericValue)) {
          valueMainDisplay.innerText = numericValue;
        } else {
          valueMainDisplay.innerText = rawValue;
        }
        if (valueDescDisplay) {
          valueDescDisplay.innerText = "";
        }
        if (!isNaN(numericValue)) {
          numericValue = Math.max(min, Math.min(max, numericValue));
          const range = max - min;
          const percentage =
            range === 0
              ? numericValue >= max
                ? 100
                : 0
              : ((numericValue - min) / range) * 100;
          progressBar.style.width = `${Math.max(
            0,
            Math.min(100, percentage)
          )}%`;
          progressBar.style.backgroundColor = color ? color : "#667eea";
        }
      }

      function toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        const toggleIcon = document.getElementById(
          sectionId.replace("-section", "-toggle")
        );
        if (section) {
          section.classList.toggle("collapsed");
          if (toggleIcon) {
            toggleIcon.classList.toggle("collapsed");
          }
        }
      }

      function toggleTheme(event) {
        event.stopPropagation();
        const currentTheme =
          document.documentElement.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        document.documentElement.setAttribute("data-theme", newTheme);
        localStorage.setItem("forum-theme", newTheme);
      }

      function syncThemeFromStorage(e) {
        if (e.key === "forum-theme") {
          const newTheme = e.newValue || "dark";
          document.documentElement.setAttribute("data-theme", newTheme);
        }
      }

      function toggleMainCollapse(event) {
        if (event) event.stopPropagation();
        const body = document.getElementById("status-body");
        const icon = document.getElementById("main-collapse-icon");
        const isCollapsing = !body.classList.contains("collapsed");
        body.classList.toggle("collapsed");
        icon.textContent = isCollapsing ? "â–¶" : "â–¼";
        localStorage.setItem("main-collapsed", isCollapsing);
        const sections = ["time-section", "account-section", "subscribe-section"];
        sections.forEach((sectionId) => {
          const section = document.getElementById(sectionId);
          const toggleIcon = document.getElementById(
            sectionId.replace("-section", "-toggle")
          );
          if (section && toggleIcon) {
            if (isCollapsing) {
              section.classList.add("collapsed");
              toggleIcon.classList.add("collapsed");
            } else {
              section.classList.remove("collapsed");
              toggleIcon.classList.remove("collapsed");
            }
          }
        });
      }

      function getEventTypeTag(type) {
        const soloTypes = ["ç‹¬è‡ªå·æƒ…å‹", "ä¸»åŠ¨å¯»æ¬¢å‹"];
        const coupleTypes = ["æ—è§‚å‹", "åŠæ”¾å…»å‹", "å®Œå…¨æ”¾å…»å‹", "ç¾è¾±å‹"];

        if (type === "ç‹¬è‡ªå·æƒ…å‹") {
          return '<span class="event-type-tag solo-cheat">ç‹¬è‡ªå·æƒ…</span>';
        } else if (type === "ä¸»åŠ¨å¯»æ¬¢å‹") {
          return '<span class="event-type-tag solo-seek">ä¸»åŠ¨å¯»æ¬¢</span>';
        } else if (coupleTypes.includes(type)) {
          return `<span class="event-type-tag couple">${type}</span>`;
        } else if (type === "å…¶ä»–") {
          return '<span class="event-type-tag other">å…¶ä»–</span>';
        } else if (type === "æ— ") {
          return "";
        }
        return `<span class="event-type-tag other">${type}</span>`;
      }

      function isSoloEvent(type) {
        return type === "ç‹¬è‡ªå·æƒ…å‹" || type === "ä¸»åŠ¨å¯»æ¬¢å‹";
      }

      function renderParticipants(type, maleName, femaleName, relationship) {
        const isSolo = isSoloEvent(type);
        const maleEmpty =
          !maleName ||
          maleName === "æ— " ||
          maleName === "ä¸çŸ¥æƒ…" ||
          maleName === "N/A";

        let html = '<div class="participant-section">';

        if (isSolo || maleEmpty) {
          html += `<div class="participant-title"><span class="icon">ğŸ‘¤</span>å‚ä¸è€…<span class="solo-indicator">â™€ ç‹¬è‡ªè¡ŒåŠ¨</span></div>`;
          html += '<div class="participant-grid">';
          html += `<div class="participant-item"><span class="participant-label">å¥³æ–¹å§“å</span><span class="participant-value female">${
            femaleName || "æœªçŸ¥"
          }</span></div>`;

          if (maleName === "ä¸çŸ¥æƒ…") {
            html += `<div class="participant-item"><span class="participant-label">ä¼´ä¾£çŠ¶æ€</span><span class="participant-value unknown">ä¸çŸ¥æƒ…</span></div>`;
          } else if (relationship) {
            html += `<div class="participant-item"><span class="participant-label">å¥³æ–¹çŠ¶æ€</span><span class="participant-value">${relationship}</span></div>`;
          }
          html += "</div>";
        } else {
          html += `<div class="participant-title"><span class="icon">ğŸ‘¥</span>å‚ä¸ä¼´ä¾£</div>`;
          html += '<div class="participant-grid">';
          html += `<div class="participant-item"><span class="participant-label">ç”·æ–¹å§“å</span><span class="participant-value male">${maleName}</span></div>`;
          html += `<div class="participant-item"><span class="participant-label">å¥³æ–¹å§“å</span><span class="participant-value female">${
            femaleName || "æœªçŸ¥"
          }</span></div>`;
          if (relationship) {
            html += `<div class="participant-item" style="grid-column: span 2;"><span class="participant-label">åŒæ–¹å…³ç³»</span><span class="participant-value">${relationship}</span></div>`;
          }
          html += "</div>";
        }

        html += "</div>";
        return html;
      }

      async function initDisplay() {
        try {
          const savedTheme = localStorage.getItem("forum-theme") || "dark";
          document.documentElement.setAttribute("data-theme", savedTheme);
          const savedMainCollapsed =
            localStorage.getItem("main-collapsed") === "true";
          if (savedMainCollapsed) {
            document.getElementById("status-body").classList.add("collapsed");
            document.getElementById("main-collapse-icon").textContent = "â–¶";
          }
          const messages = await getChatMessages(getCurrentMessageId());
          if (!messages || messages.length === 0 || !messages[0].data) {
            return;
          }
          const gameData = messages[0].data;
          const characterData = gameData.stat_data;
          if (!characterData) {
            return;
          }

          const dateElem = document.getElementById("current-date");
          if (dateElem) {
            dateElem.textContent = SafeGetValue(
              characterData,
              "æ—¶é—´æˆ³.æ—¥æœŸ",
              "2024-01-15"
            );
          }
          const timeElem = document.getElementById("current-time");
          if (timeElem) {
            timeElem.textContent = SafeGetValue(
              characterData,
              "æ—¶é—´æˆ³.æ—¶åˆ»",
              "14:30"
            );
          }
          const weekdayElem = document.getElementById("current-weekday");
          if (weekdayElem) {
            weekdayElem.textContent = SafeGetValue(
              characterData,
              "æ—¶é—´æˆ³.æ˜ŸæœŸ",
              "ä¸€"
            );
          }

          const pointsElem = document.getElementById("account-points");
          if (pointsElem) {
            pointsElem.textContent = SafeGetValue(
              characterData,
              "è´¦æˆ·.ç§¯åˆ†",
              5000
            );
          }
          const levelElem = document.getElementById("account-level");
          const levelProgress = document.getElementById("level-progress");
          if (levelElem && levelProgress) {
            const level = SafeGetValue(characterData, "è´¦æˆ·.ç­‰çº§", 20);
            levelElem.textContent = level;
            updateProgressBar(
              "level-progress",
              "account-level",
              null,
              level,
              0,
              100
            );
          }
          const expElem = document.getElementById("account-exp");
          const expProgress = document.getElementById("exp-progress");
          if (expElem && expProgress) {
            const exp = SafeGetValue(characterData, "è´¦æˆ·.ç»éªŒå€¼", 45);
            expElem.textContent = exp;
            updateProgressBar("exp-progress", "account-exp", null, exp, 0, 100);
          }
          const cashElem = document.getElementById("account-cash");
          if (cashElem) {
            const cash = SafeGetValue(characterData, "è´¦æˆ·.ç°é‡‘ä½™é¢", 0);
            cashElem.textContent = `Â¥${cash}`;
          }
          const servicesElem = document.getElementById("account-services");
          if (servicesElem) {
            const services = SafeGetValue(
              characterData,
              "è´¦æˆ·.ç´¯è®¡æœåŠ¡æ¬¡æ•°",
              8
            );
            servicesElem.textContent = `${services}æ¬¡`;
          }
          const ratingElem = document.getElementById("account-rating");
          if (ratingElem) {
            const rating = SafeGetValue(characterData, "è´¦æˆ·.å¥½è¯„ç‡", 92.5);
            ratingElem.textContent = `${rating}%`;
          }

          const subscribeTypeElem = document.getElementById("subscribe-type");
          if (subscribeTypeElem) {
            subscribeTypeElem.textContent = SafeGetValue(
              characterData,
              "å¤§è‰²æ‰¹è®¢é˜….åŒ…æœˆè®¢é˜…",
              "æ— è®¢é˜…"
            );
          }
          const subscribeDaysElem = document.getElementById("subscribe-days");
          const subscribeProgress = document.getElementById("subscribe-progress");
          if (subscribeDaysElem && subscribeProgress) {
            const days = SafeGetValue(characterData, "å¤§è‰²æ‰¹è®¢é˜….è®¢é˜…å‰©ä½™æ—¶é—´", 0);
            subscribeDaysElem.textContent = `${days}å¤©`;
            updateProgressBar(
              "subscribe-progress",
              "subscribe-days",
              null,
              days,
              0,
              30
            );
          }
          const subscribeQuotaElem = document.getElementById("subscribe-quota");
          const quotaProgress = document.getElementById("quota-progress");
          if (subscribeQuotaElem && quotaProgress) {
            const subscribeType = SafeGetValue(characterData, "å¤§è‰²æ‰¹è®¢é˜….åŒ…æœˆè®¢é˜…", "æ— è®¢é˜…");
            const quota = SafeGetValue(characterData, "å¤§è‰²æ‰¹è®¢é˜….å…è´¹é¢åº¦", 0);
            const maxQuota = subscribeType === "è€è‰²æ‰¹" ? 8 : subscribeType === "æ™®é€šè‰²æ‰¹" ? 5 : subscribeType === "å¼±é¸¡è‰²æ‰¹" ? 3 : 0;
            subscribeQuotaElem.textContent = `${quota}æ¬¡`;
            updateProgressBar(
              "quota-progress",
              "subscribe-quota",
              null,
              quota,
              0,
              maxQuota || 1
            );
          }

          const eventStatusElem = document.getElementById("event-status");
          const eventNameElem = document.getElementById("event-name");
          const eventDetailsElem = document.getElementById("event-details");
          if (eventStatusElem && eventNameElem && eventDetailsElem) {
            const status = SafeGetValue(
              characterData,
              "å½“å‰äº‹ä»¶.çŠ¶æ€",
              "æœªå¼€å§‹"
            );
            const name = SafeGetValue(characterData, "å½“å‰äº‹ä»¶.åç§°", "æ— äº‹ä»¶");
            const type = SafeGetValue(characterData, "å½“å‰äº‹ä»¶.ç±»å‹", "æ— ");
            const paymentStatus = SafeGetValue(
              characterData,
              "å½“å‰äº‹ä»¶.æŠ¥é…¬æ”¯ä»˜çŠ¶æ€",
              "æœªæ”¯ä»˜"
            );
            const appointmentTime = SafeGetValue(
              characterData,
              "å½“å‰äº‹ä»¶.çº¦å®šæ—¶é—´",
              ""
            );
            const location = SafeGetValue(characterData, "å½“å‰äº‹ä»¶.åœ°ç‚¹", "");
            const maleName = SafeGetValue(
              characterData,
              "å½“å‰äº‹ä»¶.å‚ä¸ä¼´ä¾£.ç”·æ–¹å§“å",
              ""
            );
            const femaleName = SafeGetValue(
              characterData,
              "å½“å‰äº‹ä»¶.å‚ä¸ä¼´ä¾£.å¥³æ–¹å§“å",
              ""
            );
            const relationship = SafeGetValue(
              characterData,
              "å½“å‰äº‹ä»¶.å‚ä¸ä¼´ä¾£.ä¼´ä¾£å…³ç³»",
              ""
            );
            const specialRequirements = characterData["å½“å‰äº‹ä»¶"]?.["ç‰¹æ®Šè¦æ±‚"];

            eventStatusElem.textContent = status;
            eventNameElem.textContent = name;

            let detailsHTML = "";

            if (name !== "æ— äº‹ä»¶" && paymentStatus) {
              let lightClass = "";
              if (
                paymentStatus === "æœªæ”¯ä»˜" ||
                paymentStatus === "åå‘æœªæ”¯ä»˜"
              ) {
                lightClass = "red";
              } else if (
                paymentStatus === "å·²æ”¯ä»˜" ||
                paymentStatus === "åå‘å·²æ”¯ä»˜"
              ) {
                lightClass = "green";
              } else if (paymentStatus === "æ— éœ€æ”¯ä»˜") {
                lightClass = "yellow";
              }
              detailsHTML += `<div class="event-detail-item"><span>æŠ¥é…¬æ”¯ä»˜:</span><span><div class="payment-status-indicator">${paymentStatus}<span class="status-light ${lightClass}"></span></div></span></div>`;
            }

            if (type !== "æ— ") {
              detailsHTML += `<div class="event-detail-item"><span>äº‹ä»¶ç±»å‹:</span><span>${getEventTypeTag(
                type
              )}</span></div>`;
            }
            if (appointmentTime) {
              detailsHTML += `<div class="event-detail-item"><span>çº¦å®šæ—¶é—´:</span><span>${appointmentTime}</span></div>`;
            }
            if (location) {
              detailsHTML += `<div class="event-detail-item"><span>çº¦ä¼šåœ°ç‚¹:</span><span>${location}</span></div>`;
            }

            if (femaleName || maleName) {
              detailsHTML += renderParticipants(
                type,
                maleName,
                femaleName,
                relationship
              );
            }

            if (
              Array.isArray(specialRequirements) &&
              specialRequirements.length > 0
            ) {
              detailsHTML += `<div class="event-detail-item special-requirements"><span>ç‰¹æ®Šè¦æ±‚:</span><div class="requirements-list">`;
              specialRequirements.forEach((req) => {
                detailsHTML += `<div class="requirement-item">â€¢ ${req}</div>`;
              });
              detailsHTML += `</div></div>`;
            }
            eventDetailsElem.innerHTML = detailsHTML;
          }
        } catch (error) {
          console.error("çŠ¶æ€æ åˆå§‹åŒ–å¤±è´¥:", error);
        }
      }

      window.addEventListener("storage", syncThemeFromStorage);

      setTimeout(function() {
        const savedTheme = localStorage.getItem("forum-theme") || "dark";
        document.documentElement.setAttribute("data-theme", savedTheme);
        const savedMainCollapsed = localStorage.getItem("main-collapsed") === "true";
        if (savedMainCollapsed) {
          const body = document.getElementById("status-body");
          const icon = document.getElementById("main-collapse-icon");
          if (body) body.classList.add("collapsed");
          if (icon) icon.textContent = "â–¶";
        }
        initDisplay();
      }, 0);
    </script>
  </body>
</html>
