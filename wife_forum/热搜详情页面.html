<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>çƒ­æœè¯¦æƒ… - å¦»æ‚¦è®ºå›</title>
    <link
      rel="stylesheet"
      href="https://fontsapi.zeoseven.com/292/main/result.css"
    />
  </head>

  <body>
    <style>
      :root {
        --dark-red: #c92a2a;
        --blood-red: #e03131;
        --light-red: #ff6b6b;
        --dark-gray: #1a1a1a;
        --gray: #2a2a2a;
        --light-gray: #3a3a3a;
        --text-main: #e0e0e0;
        --text-dim: #999;
        --text-dimmer: #666;
        --gold: #ffd700;
        --border: rgba(220, 20, 60, 0.2);
        --hover-bg: rgba(220, 20, 60, 0.08);
      }

      [data-theme="light"] {
        --dark-red: #c92a2a;
        --blood-red: #e03131;
        --light-red: #ff6b6b;
        --dark-gray: #f5f5f5;
        --gray: #ececec;
        --light-gray: #e0e0e0;
        --text-main: #2a2a2a;
        --text-dim: #666;
        --text-dimmer: #999;
        --gold: #d97706;
        --border: rgba(220, 20, 60, 0.15);
        --hover-bg: rgba(220, 20, 60, 0.05);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Noto Sans SC", -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        color: var(--text-main);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .detail-container {
        width: 100%;
        max-width: 820px;
        margin: 0 auto;
        background: var(--dark-gray);
        font-size: var(--base-font-size, 14px);
        min-height: 100vh;
      }

      .detail-container.font-medium {
        --base-font-size: 16px;
      }

      .detail-container.font-large {
        --base-font-size: 18px;
      }

      .detail-container.font-xlarge {
        --base-font-size: 20px;
      }

      .detail-header {
        background: var(--blood-red);
        padding: 10px 16px;
        position: sticky;
        top: 0;
        z-index: 100;
        border-bottom: 1px solid var(--border);
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }

      .back-button {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: #fff;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s;
        font-size: 0.85em;
        font-weight: 500;
        outline: none;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .back-button:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .page-title {
        font-size: 1em;
        font-weight: 600;
        color: #fff;
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .theme-toggle {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: #fff;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s;
        font-size: 0.85em;
        font-weight: 500;
        outline: none;
      }

      .theme-toggle:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .title-section {
        background: var(--gray);
        padding: 20px 16px;
        border-bottom: 1px solid var(--border);
      }

      .hot-title {
        font-size: 1.4em;
        font-weight: 700;
        color: var(--text-main);
        margin-bottom: 12px;
        line-height: 1.4;
      }

      .title-meta {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .hot-badge {
        display: inline-block;
        background: linear-gradient(135deg, var(--blood-red), var(--dark-red));
        color: #fff;
        padding: 4px 12px;
        border-radius: 16px;
        font-size: 0.8em;
        font-weight: 600;
      }

      .author-info {
        display: flex;
        align-items: center;
        gap: 6px;
        color: var(--text-dim);
        font-size: 0.85em;
      }

      .author-avatar {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--gold), #d97706);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 0.7em;
        font-weight: 600;
      }

      .author-name {
        color: var(--text-main);
        font-weight: 500;
      }

      .stats-section {
        background: var(--dark-gray);
        padding: 16px;
        border-bottom: 1px solid var(--border);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .stat-card {
        background: var(--gray);
        padding: 12px;
        border-radius: 8px;
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .stat-label {
        color: var(--text-dim);
        font-size: 0.8em;
      }

      .stat-value {
        color: var(--blood-red);
        font-size: 1.1em;
        font-weight: 600;
      }

      .news-section {
        background: var(--gray);
        padding: 16px;
        margin: 16px;
        border-radius: 8px;
        border: 1px solid var(--border);
      }

      .section-title {
        color: var(--text-main);
        font-size: 1.1em;
        font-weight: 600;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .news-section .section-title {
        font-size: 1.3em;
      }

      .news-content {
        color: var(--text-dim);
        font-size: 1.05em;
        line-height: 1.8;
        white-space: pre-wrap;
      }

      .comments-section {
        background: var(--dark-gray);
        padding: 16px;
        border-bottom: 1px solid var(--border);
      }

      .comment-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-top: 12px;
      }

      .comment-card {
        background: var(--gray);
        padding: 14px;
        border-radius: 8px;
        border: 1px solid var(--border);
        transition: all 0.2s;
      }

      .comment-card:hover {
        background: var(--hover-bg);
        border-color: var(--blood-red);
      }

      .comment-card.has-reply {
        border-left: 3px solid var(--blood-red);
      }

      .comment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .comment-user {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .comment-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--blood-red), var(--dark-red));
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 0.85em;
        font-weight: 600;
        flex-shrink: 0;
      }

      .comment-name {
        color: var(--text-main);
        font-size: 0.95em;
        font-weight: 500;
      }

      .comment-time {
        color: var(--text-dimmer);
        font-size: 0.75em;
      }

      .comment-content {
        color: var(--text-dim);
        font-size: 1.05em;
        line-height: 1.7;
        margin-bottom: 10px;
      }

      .comment-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .comment-actions {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .comment-action {
        display: flex;
        align-items: center;
        gap: 4px;
        color: var(--text-dimmer);
        font-size: 0.95em;
        cursor: pointer;
        transition: color 0.2s;
      }

      .comment-action:hover {
        color: var(--blood-red);
      }

      .like-icon {
        color: var(--blood-red);
      }

      .comment-reply {
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid var(--border);
      }

      .reply-item {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
      }

      .reply-item:last-child {
        margin-bottom: 0;
      }

      .reply-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--light-gray), var(--gray));
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-dim);
        font-size: 0.7em;
        font-weight: 600;
        flex-shrink: 0;
      }

      .reply-content-wrapper {
        flex: 1;
        min-width: 0;
      }

      .reply-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
        flex-wrap: wrap;
      }

      .reply-name {
        color: var(--text-main);
        font-size: 0.85em;
        font-weight: 500;
      }

      .reply-target {
        color: var(--text-dimmer);
        font-size: 0.8em;
      }

      .reply-arrow {
        color: var(--text-dimmer);
        font-size: 0.8em;
      }

      .reply-text {
        color: var(--text-dim);
        font-size: 0.95em;
        line-height: 1.6;
      }

      .related-section {
        background: var(--dark-gray);
        padding: 16px;
        padding-bottom: 32px;
      }

      .related-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-top: 12px;
      }

      .related-card {
        background: var(--gray);
        padding: 12px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .related-card:hover {
        background: var(--hover-bg);
        border-color: var(--blood-red);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(220, 20, 60, 0.15);
      }

      .related-card:active {
        transform: translateY(0);
      }

      .related-title {
        color: var(--text-main);
        font-size: 0.9em;
        font-weight: 500;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .related-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .related-heat {
        color: var(--text-dim);
        font-size: 0.75em;
      }

      .related-trend {
        font-size: 0.9em;
      }

      .loading {
        text-align: center;
        padding: 50px;
        color: var(--text-dim);
        font-size: 1.1em;
      }

      @media (max-width: 768px) {
        .detail-container {
          font-size: var(--base-font-size, 13px);
        }

        .detail-container.font-medium {
          --base-font-size: 15px;
        }

        .detail-container.font-large {
          --base-font-size: 17px;
        }

        .detail-container.font-xlarge {
          --base-font-size: 19px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .related-grid {
          grid-template-columns: 1fr;
        }
      }

      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(220, 20, 60, 0.3);
        border-radius: 3px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: rgba(220, 20, 60, 0.5);
      }

      * {
        -webkit-tap-highlight-color: transparent;
      }

      .keyword-confirm-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.7);
        z-index: 999;
        justify-content: center;
        align-items: flex-end;
        padding-bottom: 70px;
      }

      .keyword-confirm-overlay.active {
        display: flex;
      }

      .keyword-confirm-box {
        background: var(--gray);
        border-radius: 12px;
        padding: 24px;
        max-width: 320px;
        width: 90%;
        border: 1px solid var(--border);
      }

      .keyword-confirm-title {
        color: var(--text-main);
        font-size: 1.1em;
        font-weight: 600;
        margin-bottom: 12px;
        text-align: center;
      }

      .keyword-confirm-keyword {
        color: var(--blood-red);
        font-size: 1.2em;
        font-weight: 600;
        text-align: center;
        margin-bottom: 20px;
      }

      .keyword-confirm-buttons {
        display: flex;
        gap: 12px;
      }

      .keyword-confirm-btn {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 6px;
        font-size: 0.95em;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .keyword-confirm-btn.cancel {
        background: var(--light-gray);
        color: var(--text-main);
      }

      .keyword-confirm-btn.cancel:hover {
        background: var(--gray);
      }

      .keyword-confirm-btn.confirm {
        background: var(--blood-red);
        color: #fff;
      }

      .keyword-confirm-btn.confirm:hover {
        background: var(--dark-red);
      }
    </style>

    <div class="detail-container" id="detail-container">
      <div class="loading">ç•Œé¢åŠ è½½å¤±è´¥,è¯·é‡rollèŠå¤©è¯•è¯•...</div>
    </div>

    <div class="keyword-confirm-overlay" id="keyword-confirm-overlay">
      <div class="keyword-confirm-box">
        <div class="keyword-confirm-title">æŸ¥çœ‹çƒ­æœ</div>
        <div class="keyword-confirm-keyword" id="keyword-confirm-text"></div>
        <div class="keyword-confirm-buttons">
          <button
            class="keyword-confirm-btn cancel"
            onclick="closeKeywordConfirm()"
          >
            å–æ¶ˆ
          </button>
          <button
            class="keyword-confirm-btn confirm"
            onclick="confirmKeywordSearch()"
          >
            æŸ¥çœ‹
          </button>
        </div>
      </div>
    </div>

    <script>
      const chat_message = getChatMessages(getCurrentMessageId())[0];
      const match = chat_message.message.match(
        /<hot_search_detail>([\s\S]*?)<\/hot_search_detail>/
      );
      const hotSearchDetailXML = match
        ? match[0]
        : "<hot_search_detail></hot_search_detail>";

      function parseHotSearchDetailXML(xmlText) {
        console.log("========== çƒ­æœè¯¦æƒ…æ•°æ®è§£æå¼€å§‹ ==========");
        console.log("XMLæ•°æ®é•¿åº¦:", xmlText.length);

        const data = {
          title: "",
          badge: "",
          author: "",
          stats: [],
          newsReport: "",
          comments: [],
          relatedTopics: [],
        };

        try {
          const titleMatch = xmlText.match(/<title>([\s\S]*?)<\/title>/i);
          if (titleMatch && titleMatch[1]) {
            data.title = titleMatch[1].trim();
          }

          const badgeMatch = xmlText.match(/<badge>([\s\S]*?)<\/badge>/i);
          if (badgeMatch && badgeMatch[1]) {
            data.badge = badgeMatch[1].trim();
          }

          const authorMatch = xmlText.match(/<author>([\s\S]*?)<\/author>/i);
          if (authorMatch && authorMatch[1]) {
            data.author = authorMatch[1].trim();
          }

          const statsMatch = xmlText.match(/<stats>([\s\S]*?)<\/stats>/i);
          if (statsMatch && statsMatch[1]) {
            const statRegex = /\[æ•°æ®\|([^\|]+)\|([^\]]+)\]/g;
            let statItem;
            while ((statItem = statRegex.exec(statsMatch[1])) !== null) {
              data.stats.push({
                label: statItem[1],
                value: statItem[2],
              });
            }
          }

          const newsMatch = xmlText.match(
            /<news_report>([\s\S]*?)<\/news_report>/i
          );
          if (newsMatch && newsMatch[1]) {
            data.newsReport = newsMatch[1].trim();
          }

          const commentsMatch = xmlText.match(
            /<hot_comments>([\s\S]*?)<\/hot_comments>/i
          );
          if (commentsMatch && commentsMatch[1]) {
            const commentRegex =
              /\[è¯„è®º\|([^\|]+)\|([^\|]+)\|([^\|]+)\|([^\|]*)\|([^\]]+)\]/g;
            let commentItem;
            while (
              (commentItem = commentRegex.exec(commentsMatch[1])) !== null
            ) {
              const replies = [];
              if (commentItem[4]) {
                const replyParts = commentItem[4].split(">>");
                for (let i = 0; i < replyParts.length; i++) {
                  const replyText = replyParts[i].trim();
                  if (replyText) {
                    const replyMatch = replyText.match(/^([^:ï¼š]+)[ï¼š:](.+)$/);
                    if (replyMatch) {
                      replies.push({
                        name: replyMatch[1].trim(),
                        text: replyMatch[2].trim(),
                      });
                    }
                  }
                }
              }
              data.comments.push({
                name: commentItem[1],
                content: commentItem[2],
                likes: commentItem[3],
                replies: replies,
                time: commentItem[5],
              });
            }
          }

          const topicsMatch = xmlText.match(
            /<related_topics>([\s\S]*?)<\/related_topics>/i
          );
          if (topicsMatch && topicsMatch[1]) {
            const topicRegex = /\[è¯é¢˜\|([^\|]+)\|([^\|]+)\|([^\]]+)\]/g;
            let topicItem;
            while ((topicItem = topicRegex.exec(topicsMatch[1])) !== null) {
              data.relatedTopics.push({
                title: topicItem[1],
                heat: topicItem[2],
                trend: topicItem[3],
              });
            }
          }

          console.log("è§£æå®Œæˆ - æ ‡é¢˜:", data.title);
          console.log("è§£æå®Œæˆ - ç»Ÿè®¡æ•°æ®:", data.stats.length);
          console.log("è§£æå®Œæˆ - è¯„è®ºæ•°é‡:", data.comments.length);
          console.log("è§£æå®Œæˆ - ç›¸å…³è¯é¢˜:", data.relatedTopics.length);
          console.log("========== çƒ­æœè¯¦æƒ…æ•°æ®è§£æå®Œæˆ ==========");
          return data;
        } catch (error) {
          console.error("è§£æçƒ­æœè¯¦æƒ…æ•°æ®å‡ºé”™:", error);
          return data;
        }
      }

      function renderHotSearchDetail(data) {
        console.log("å¼€å§‹æ¸²æŸ“çƒ­æœè¯¦æƒ…...");

        const container = document.getElementById("detail-container");

        if (!data.title) {
          container.innerHTML = `
            <header class="detail-header">
              <div class="header-content">
                <button class="back-button" onclick="goBack()">
                  â† è¿”å›
                </button>
                <div class="page-title">çƒ­æœè¯¦æƒ…</div>
                <button class="theme-toggle" onclick="cycleFontSize()">
                  <span id="font-size-icon">A</span>
                </button>
                <button class="theme-toggle" onclick="toggleTheme()">
                  <span id="theme-icon">ğŸŒ™</span>
                </button>
              </div>
            </header>
            <div class="loading">æœªæ‰¾åˆ°çƒ­æœè¯¦æƒ…æ•°æ®</div>
          `;
          return;
        }

        let statsHTML = "";
        data.stats.forEach((stat) => {
          statsHTML += `
            <div class="stat-card">
              <div class="stat-label">${stat.label}</div>
              <div class="stat-value">${stat.value}</div>
            </div>
          `;
        });

        let commentsHTML = "";
        data.comments.forEach((comment) => {
          const initial = comment.name.charAt(0);
          const hasReply = comment.replies && comment.replies.length > 0;

          let repliesHTML = "";
          if (hasReply) {
            repliesHTML = '<div class="comment-reply">';
            comment.replies.forEach((reply, index) => {
              const replyInitial = reply.name.charAt(0);
              const targetName =
                index === 0 ? comment.name : comment.replies[index - 1].name;
              repliesHTML += `
                <div class="reply-item">
                  <div class="reply-avatar">${replyInitial}</div>
                  <div class="reply-content-wrapper">
                    <div class="reply-header">
                      <span class="reply-name">${reply.name}</span>
                      <span class="reply-arrow">â†’</span>
                      <span class="reply-target">${targetName}</span>
                    </div>
                    <div class="reply-text">${reply.text}</div>
                  </div>
                </div>
              `;
            });
            repliesHTML += "</div>";
          }

          commentsHTML += `
            <div class="comment-card ${hasReply ? "has-reply" : ""}">
              <div class="comment-header">
                <div class="comment-user">
                  <div class="comment-avatar">${initial}</div>
                  <div class="comment-name">${comment.name}</div>
                </div>
                <div class="comment-time">${comment.time}</div>
              </div>
              <div class="comment-content">${comment.content}</div>
              <div class="comment-footer">
                <div class="comment-actions">
                  <div class="comment-action">
                    <span class="like-icon">â¤ï¸</span>
                    <span>${comment.likes}</span>
                  </div>
                  ${
                    hasReply
                      ? `<div class="comment-action">ğŸ’¬ ${comment.replies.length}æ¡å›å¤</div>`
                      : ""
                  }
                </div>
              </div>
              ${repliesHTML}
            </div>
          `;
        });

        let relatedHTML = "";
        data.relatedTopics.forEach((topic) => {
          relatedHTML += `
            <div class="related-card" onclick="viewHotSearchConfirm('${topic.title}'); event.stopPropagation();">
              <div class="related-title">${topic.title}</div>
              <div class="related-footer">
                <span class="related-heat">${topic.heat}</span>
                <span class="related-trend">${topic.trend}</span>
              </div>
            </div>
          `;
        });

        container.innerHTML = `
          <header class="detail-header">
            <div class="header-content">
              <button class="back-button" onclick="goBack()">
                â† è¿”å›
              </button>
              <div class="page-title">çƒ­æœè¯¦æƒ…</div>
              <button class="theme-toggle" onclick="cycleFontSize()">
                <span id="font-size-icon">A</span>
              </button>
              <button class="theme-toggle" onclick="toggleTheme()">
                <span id="theme-icon">ğŸŒ™</span>
              </button>
            </div>
          </header>

          <div class="title-section">
            <div class="hot-title">${data.title}</div>
            <div class="title-meta">
              <span class="hot-badge">${data.badge}</span>
              ${
                data.author
                  ? `
              <div class="author-info">
                <div class="author-avatar">${data.author.charAt(0)}</div>
                <span class="author-name">${data.author}</span>
              </div>
              `
                  : ""
              }
            </div>
          </div>

          ${
            data.stats.length > 0
              ? `
          <div class="stats-section">
            <div class="stats-grid">
              ${statsHTML}
            </div>
          </div>
          `
              : ""
          }

          ${
            data.newsReport
              ? `
          <div class="news-section">
            <div class="section-title">ğŸ“° æ·±åº¦æŠ¥é“</div>
            <div class="news-content">${data.newsReport}</div>
          </div>
          `
              : ""
          }

          ${
            data.comments.length > 0
              ? `
          <div class="comments-section">
            <div class="section-title">ğŸ’¬ çƒ­é—¨è¯„è®º (${data.comments.length})</div>
            <div class="comment-list">
              ${commentsHTML}
            </div>
          </div>
          `
              : ""
          }

          ${
            data.relatedTopics.length > 0
              ? `
          <div class="related-section">
            <div class="section-title">ğŸ”— ç›¸å…³çƒ­æœ</div>
            <div class="related-grid">
              ${relatedHTML}
            </div>
          </div>
          `
              : ""
          }
        `;

        console.log("çƒ­æœè¯¦æƒ…æ¸²æŸ“å®Œæˆ");
      }

      function cycleFontSize() {
        const container = document.getElementById("detail-container");
        const icon = document.getElementById("font-size-icon");
        const fontSizes = ["small", "medium", "large", "xlarge"];
        const fontIcons = ["A", "A+", "A++", "A+++"];

        let currentSize = localStorage.getItem("forum-font-size") || "small";
        let currentIndex = fontSizes.indexOf(currentSize);
        let nextIndex = (currentIndex + 1) % fontSizes.length;
        let nextSize = fontSizes[nextIndex];

        container.classList.remove("font-medium", "font-large", "font-xlarge");
        if (nextSize !== "small") {
          container.classList.add("font-" + nextSize);
        }

        icon.textContent = fontIcons[nextIndex];
        localStorage.setItem("forum-font-size", nextSize);
      }

      function toggleTheme() {
        const body = document.body;
        const icon = document.getElementById("theme-icon");
        const isLight = body.getAttribute("data-theme") === "light";

        if (isLight) {
          body.removeAttribute("data-theme");
          icon.textContent = "ğŸŒ™";
          localStorage.setItem("forum-theme", "dark");
        } else {
          body.setAttribute("data-theme", "light");
          icon.textContent = "â˜€ï¸";
          localStorage.setItem("forum-theme", "light");
        }
      }

      function syncThemeFromStorage(e) {
        if (e.key === "forum-theme") {
          const body = document.body;
          const icon = document.getElementById("theme-icon");

          if (e.newValue === "light") {
            body.setAttribute("data-theme", "light");
            if (icon) icon.textContent = "â˜€ï¸";
          } else {
            body.removeAttribute("data-theme");
            if (icon) icon.textContent = "ğŸŒ™";
          }
        }

        if (e.key === "forum-font-size") {
          const container = document.getElementById("detail-container");
          const icon = document.getElementById("font-size-icon");
          const fontSizes = ["small", "medium", "large", "xlarge"];
          const fontIcons = ["A", "A+", "A++", "A+++"];

          container.classList.remove(
            "font-medium",
            "font-large",
            "font-xlarge"
          );
          if (e.newValue && e.newValue !== "small") {
            container.classList.add("font-" + e.newValue);
          }

          let index = fontSizes.indexOf(e.newValue || "small");
          if (icon) icon.textContent = fontIcons[index];
        }
      }

      function goBack() {
        const cmd = `/send æ‰“å¼€æœç´¢é¡µé¢ | /trigger`;
        if (typeof triggerSlash === "function") {
          triggerSlash(cmd);
        }
      }

      function viewHotSearch(title) {
        const cmd = `/send æŸ¥çœ‹çƒ­æœ:${title} | /trigger`;
        if (typeof triggerSlash === "function") {
          triggerSlash(cmd);
        }
      }

      let pendingKeyword = "";

      function viewHotSearchConfirm(keyword) {
        pendingKeyword = keyword;
        document.getElementById(
          "keyword-confirm-text"
        ).textContent = `${keyword}`;
        const overlay = document.getElementById("keyword-confirm-overlay");
        overlay.classList.add("active");
      }

      function closeKeywordConfirm() {
        const overlay = document.getElementById("keyword-confirm-overlay");
        overlay.classList.remove("active");
        pendingKeyword = "";
      }

      function confirmKeywordSearch() {
        if (pendingKeyword) {
          const cmd = `/send æŸ¥çœ‹çƒ­æœ:${pendingKeyword} | /trigger`;
          if (typeof triggerSlash === "function") {
            triggerSlash(cmd);
          }
        }
        closeKeywordConfirm();
      }

      window.addEventListener("storage", syncThemeFromStorage);

      setTimeout(function () {
        const theme = localStorage.getItem("forum-theme");
        if (theme === "light") {
          document.body.setAttribute("data-theme", "light");
        }

        const fontSize = localStorage.getItem("forum-font-size") || "small";
        const container = document.getElementById("detail-container");
        const fontSizes = ["small", "medium", "large", "xlarge"];
        const fontIcons = ["A", "A+", "A++", "A+++"];

        if (fontSize !== "small") {
          container.classList.add("font-" + fontSize);
        }

        console.log("é¡µé¢åŠ è½½å®Œæˆ,å¼€å§‹è§£æçƒ­æœè¯¦æƒ…æ•°æ®");
        try {
          const data = parseHotSearchDetailXML(hotSearchDetailXML);
          renderHotSearchDetail(data);

          if (theme === "light") {
            const icon = document.getElementById("theme-icon");
            if (icon) {
              icon.textContent = "â˜€ï¸";
            }
          }

          let index = fontSizes.indexOf(fontSize);
          const fontIcon = document.getElementById("font-size-icon");
          if (fontIcon) {
            fontIcon.textContent = fontIcons[index];
          }
        } catch (error) {
          console.error("æ¸²æŸ“å¤±è´¥:", error);
          document.getElementById("detail-container").innerHTML =
            '<div class="loading">æ•°æ®åŠ è½½å¤±è´¥,è¯·åˆ·æ–°é‡è¯•</div>';
        }
      }, 0);
    </script>
  </body>
</html>
